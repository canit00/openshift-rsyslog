= openshift-rsyslog
This is using DaemonSets and ConfigMaps to configure rsyslog on an OpenShift Cluster
to send all log files to an external rsyslog server.

== Setup Project
----
# oadm new-project rsyslog --node-selector=""
$ oc project rsyslog
----

=== Set SCC
The rsyslog pods need to run privileged in order to access certain system resources.

* /etc/machine-id - read
* /etc/hostname - read
* /etc/localtime - read
* /var/log - read/write
* /run/log - read/write


As *system:admin* do the following:
----
# oadm policy add-scc-to-user privileged system:serviceaccount:rsyslog:default
----

=== Create DaemonSet
----
$ oc create -f ds-rsyslog.yaml
----

=== Create ConfigMap
The config map contains an additional configuration file that will be placed in /etc/rsyslog.d/.
This file contains the remote logging server address.

----
$ oc create -f cm-rsyslog.yaml
----

== Example

----
root@master:~$ oadm new-project rsyslog --node-selector=""
Created project rsyslog
root@master:~$ oc project rsyslog
Already on project "rsyslog" on server "https://master.manage.bm.chmouel.com:8443".
root@master:~$ oadm policy add-scc-to-user privileged system:serviceaccount:rsyslog:default
root@master:~$ oc create -f ds-rsyslog.yaml
daemonset "rsyslog" created
root@master:~$ oc create -f cm-rsyslog.yaml
configmap "rsyslog-config-cm" created
root@master:~$ oc get po
NAME            READY     STATUS    RESTARTS   AGE
rsyslog-acuhj   1/1       Running   0          1m
rsyslog-mvqkc   1/1       Running   0          1m
rsyslog-o2fmf   1/1       Running   0          1m
----
